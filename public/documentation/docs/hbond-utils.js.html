<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hbond-utils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hbond-utils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
#######################################################
Utils for hydrogen bond file loading
#######################################################
*/

/**
 * Async function to load hydrogen bond files.
 * 
 * After loading, we make an array of vertices and pair together the vertices that form each hydrogen bond.
 * We then create a custom object composed of cylinders using the vertex pairs.
 * 
 * @param {string} File name in uploads folder.
 * 
 */
async function loadHBond(file) {
	var bonds = []; var bondPairs = []; // array holds the coordinates for each bond and bond pairs
	var bondIndex = 0; var pairIndex = 0; // index for keeing track of bonds and pairs
	var totalPairs; var totalBonds;
	var readingBonds = false; var readingPair = false; // boolean to switch between reading bond vertices and bond pairs
	var temp; // temporary variable

	let data = await fetch("../uploads/" + file).then(response => response.text());
	var lines = data.toString().split("\n");

	for (var i = 0; i &lt; lines.length; i++) {
		// Reading vertices
		if (!readingBonds) {
			if (lines[i].split(" ")[0] == "#NUMBER_OF_ATOMS") {
				totalBonds = parseInt(lines[i].split(" ")[1]);
				readingBonds = true;
			}
		} else {
			if (bondIndex &lt; totalBonds) {
				temp = (lines[i].replace(/\s+/g, ' ').trim()).split(" ");
				x = parseFloat(temp[5]);
				y = parseFloat(temp[6]);
				z = parseFloat(temp[7]);
				bonds.push([x, y, z]);

				bondIndex++;
			} else {
				// Pairing together vertices that form bonds
				if (!readingPair) {
					if (lines[i].split(" ")[0] == "#NUMBER_OF_HBONDS") {
						totalPairs = parseInt(lines[i].split(" ")[1]);
						readingPair = true;
					}
				} else {
					if (pairIndex &lt; totalPairs) {
						temp = (lines[i].replace(/\s+/g, ' ').trim()).split(" ");
						first = bonds[parseInt(temp[0])];
						second = bonds[parseInt(temp[1])];
						bondPairs.push([first, second]);

						pairIndex++;
					}
				}
			}
		}
	}
	// Render hydrogen bonds
	viewHBond(file, bonds, bondPairs);
}

/**
 * Function to view hydrogen bonds after loading data
 * 
 * Set colors and add objects to stage here.
 * This function is called at the end of loadHBond()	
 * 
 * @param {string} file 
 * @param {array[]} bonds 
 * @param {array[]} bondPairs 
 */
function viewHBond(file, bonds, bondPairs) {
	var mesh_vertex = [];
	var mesh_color = [];
	var mesh_normal = [];

	console.log("Updating viewer with " + file);
	var shape = new NGL.Shape(file);
	shape.addMesh(bonds, (0, 0, 0, 0), undefined, undefined);
	for (var i = 0; i &lt; bondPairs.length; i++) {
		// Add each bond as a grey cylinder
		shape.addCylinder(bondPairs[i][0], bondPairs[i][1], [0.5, 0.5, 0.5], 0.2);
	}
	var shapeComp = stage.addComponentFromObject(shape);
	shapeComp.addRepresentation("buffer");
	shapeComp.setVisibility(true);
	shapeComp.autoView();
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Documentations</a></h2><h3>Classes</h3><ul><li><a href="file_tree_dir.html">file_tree_dir</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-docker-container-tutorial.html">Installing Docker and Cloning A Containerized Web Server</a></li><li><a href="tutorial-run-code-server-tutorial.html">Adding and Running an Executable to the Server</a></li></ul><h3>Global</h3><ul><li><a href="global.html#color_val">color_val</a></li><li><a href="global.html#expandPDB">expandPDB</a></li><li><a href="global.html#getXML">getXML</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#loadHBond">loadHBond</a></li><li><a href="global.html#loadPDB">loadPDB</a></li><li><a href="global.html#makeTree">makeTree</a></li><li><a href="global.html#set_up_tree">set_up_tree</a></li><li><a href="global.html#stage">stage</a></li><li><a href="global.html#treeSelectionEventHandler">treeSelectionEventHandler</a></li><li><a href="global.html#viewData">viewData</a></li><li><a href="global.html#viewHBond">viewHBond</a></li><li><a href="global.html#viewer">viewer</a></li><li><a href="global.html#visible_components">visible_components</a></li><li><a href="global.html#xmlhttp">xmlhttp</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Thu Jul 13 2023 13:24:30 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
