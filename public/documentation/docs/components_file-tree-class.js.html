<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/file-tree-class.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/file-tree-class.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * FileTreeDirectory class handles parsing of uploads folder and post request for file names.
 */
class FileTreeDirectory {
	/**
	 * Constructor for FileTreeDirectory class.
	 * @param {string} id ID of the directory to be parsed. This is usually uploads
	 * @param {'smart-tree'} tree
	 */
	constructor(id, tree) {
		this.id = id;
		this.tree = tree;
		this.fileHierarchy = []

		this.SURF_files = [];
		this.pdb_files = [];
		this.hbond_files = [];
		this.other = [];
	}

	// Call to asynchronously fetch and set files
	async init() {
		await this.initializeFiles();
		await this.initializeTree();
		return this;
	}

	async getFiles(id) {
		try {
			var response = await fetch('/files_in_dir', {
				method: 'POST',
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ "id": id })
			});
			if (!response.ok) {
				throw new Error('Network response was not ok.');
			}
			var responseData = await response.json();
			var files = JSON_response_parser(JSON.stringify(responseData));
			return files
		} catch (error) {
			console.error("Failed fetching files:", error);
		}
	}

	async initializeFiles() {
		let hierarchy = {
			files: [], // Files in the root
			directories: {} // Directories with their respective files
		};
		for (const item of this.id) {
			if (item.includes('.')) {
				// It's a file, add it to the root files list
				hierarchy.files.push(item);
			} else {
				// It's a directory, need to fetch its contents
				try {
					// Assuming `getFiles` fetches the contents of the directory and returns a list of file names
					const directoryFiles = await this.getFiles(item);
					// Now, process the fetched files
					hierarchy.directories[item] = directoryFiles;
					// This filters out any subdirectories, assuming you only go one directory deep
					// and assuming `getFiles` returns filenames with dots for actual files
				} catch (error) {
					console.error(`Failed to fetch files for directory ${item}:`, error);
				}
			}
		}

		this.fileHierarchy = hierarchy; // Store the hierarchy structure
		console.log("File hierarchy", this.fileHierarchy); // Log the hierarchy structure
	}

	async initializeTree() {
		for (let rootDirs in this.fileHierarchy.directories) {
			this.startTree(this.tree, rootDirs)
			console.log(this.fileHierarchy.directories[rootDirs])
			for (let i = 0; i &lt; this.fileHierarchy.directories[rootDirs].length; i++) {
				this.makeTree(this.tree, rootDirs, this.fileHierarchy.directories[rootDirs][i])
			}
		}
	}

	/**
	 * Groups files by file format (e.g., pdb, SURF) and updates the corresponding properties.
	 */
	groupFileFormats() {
		this.files.forEach(file => {
			var fileFormat = file.split(".").pop();
			switch (fileFormat) {
				case "SURF":
					this.SURF_files.push(file);
					break;
				case "pdb":
					this.pdb_files.push(file);
					break;
				case "txt":
					this.hbond_files.push(file);
					break;
				default:
					this.other.push(file);
			}
		});
	}

	// function starts the tree by adding a group item first
	startTree(tree, id) {
		var newGroup = document.createElement('smart-tree-items-group');
		newGroup.id = id;
		newGroup.label = id;
		newGroup.expanded = true;
		newGroup.separator = false;
		// newGroup.level = -1;
		tree.addTo(newGroup)
		return;
	}

	/**
	 * Creates tree from a list of files
	 * 
	 * @param {smart-tree} tree 
	 * @param {string} id 
	 * @param {string} files 
	 */
	makeTree(tree, parent_id, label) {
		var newItem = document.createElement('smart-tree-items');
		newItem.label = label
		tree.addTo(newItem, parent_id);
	}

	async callbackAllFiles(callback) {
		var files = [];
		var hierarchy = this.fileHierarchy
		// Loop through directories and their files
		for (let dir in hierarchy.directories) {
			if (hierarchy.directories.hasOwnProperty(dir)) {
				hierarchy.directories[dir].forEach(file => {
					callback(dir, file)
				});
			}
		}
		// Loop through files in the root
		this.fileHierarchy.files.forEach(file => {
			callback(dir, file)
		});
		return files
	}
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Documentations</a></h2><h3>Classes</h3><ul><li><a href="FileTreeDirectory.html">FileTreeDirectory</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-docker-container-tutorial.html">Installing Docker and Cloning A Containerized Web Server</a></li><li><a href="tutorial-run-code-server-tutorial.html">Adding and Running an Executable to the Server</a></li></ul><h3>Global</h3><ul><li><a href="global.html#JSON_response_parser">JSON_response_parser</a></li><li><a href="global.html#color_val">color_val</a></li><li><a href="global.html#expandPDB">expandPDB</a></li><li><a href="global.html#getFiles">getFiles</a></li><li><a href="global.html#getXML">getXML</a></li><li><a href="global.html#loadData">loadData</a></li><li><a href="global.html#loadHBond">loadHBond</a></li><li><a href="global.html#loadPDB">loadPDB</a></li><li><a href="global.html#treeSelectionEventHandler">treeSelectionEventHandler</a></li><li><a href="global.html#viewData">viewData</a></li><li><a href="global.html#viewHBond">viewHBond</a></li><li><a href="global.html#viewer">viewer</a></li><li><a href="global.html#visible_components">visible_components</a></li><li><a href="global.html#xmlhttp">xmlhttp</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Thu Mar 14 2024 01:50:52 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
